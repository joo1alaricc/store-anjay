<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Profil - Tian Store</title>
  <style>
    :root {
      --primary-500: #0B61FF;
      --primary-400: #2A8DFF;
      --primary-300: #79AFFF;
      --white: #FFFFFF;
      --glass-bg: rgba(255, 255, 255, 0.8);
      --glass-border: rgba(255, 255, 255, 0.2);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    body {
      background: linear-gradient(135deg, var(--primary-500), var(--primary-300));
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      color: white;
    }

    .logo {
      font-size: 24px;
      font-weight: 700;
    }

    .back-btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      backdrop-filter: blur(10px);
    }

    .card {
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }

    .card h2 {
      color: var(--primary-500);
      margin-bottom: 16px;
      font-size: 20px;
    }

    .profile-info, .orders-list, .form-group {
      margin-bottom: 12px;
    }

    .profile-info span, .order-item {
      display: block;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    .btn {
      background: var(--primary-500);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      margin-top: 10px;
    }

    .btn:hover {
      background: var(--primary-400);
    }

    input {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border: 1px solid #ddd;
      border-radius: 8px;
    }

    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--primary-500);
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 500;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }

    .notification.show {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">Profil Saya</div>
      <button class="back-btn" onclick="window.location.href='index.html'">‚Üê Kembali</button>
    </div>

    <div class="card">
      <h2>‚ÑπÔ∏è Informasi Profil</h2>
      <div class="profile-info" id="profileInfo"></div>
    </div>

    <div class="card">
      <h2>üì¶ Riwayat Pesanan</h2>
      <div class="orders-list" id="ordersList"></div>
    </div>

    <div class="card">
      <h2>üîê Ganti Password</h2>
      <div class="form-group">
        <input type="password" id="oldPass" placeholder="Password Lama" />
        <input type="password" id="newPass" placeholder="Password Baru" />
        <input type="password" id="confirmPass" placeholder="Konfirmasi Baru" />
        <button class="btn" onclick="changePassword()">Simpan Perubahan</button>
      </div>
    </div>

    <div class="card">
      <h2>‚úèÔ∏è Edit Profil</h2>
      <div class="form-group">
        <input type="text" id="editUsername" placeholder="Username" />
        <input type="tel" id="editPhone" placeholder="Nomor Telepon" />
        <button class="btn" onclick="updateProfile()">Perbarui Profil</button>
      </div>
    </div>
  </div>

  <div id="notification" class="notification"></div>

  <script>
    if (!localStorage.getItem('loggedUser')) {
      window.location.href = 'login.html';
    }

    function showNotification(message) {
      const notif = document.getElementById('notification');
      notif.textContent = message;
      notif.classList.add('show');
      setTimeout(() => notif.classList.remove('show'), 3000);
    }

    function loadProfile() {
      const user = JSON.parse(localStorage.getItem('loggedUser'));
      document.getElementById('profileInfo').innerHTML = `
        <span><strong>Username:</strong> ${user.username}</span>
        <span><strong>Email:</strong> ${user.email}</span>
        <span><strong>Telepon:</strong> ${user.phone}</span>
        <span><strong>Referral:</strong> ${user.referral || '-'}</span>
      `;

      document.getElementById('editUsername').value = user.username;
      document.getElementById('editPhone').value = user.phone;
    }

    function loadOrders() {
      const orders = JSON.parse(localStorage.getItem('orders')) || [];
      const list = document.getElementById('ordersList');
      if (orders.length === 0) {
        list.innerHTML = '<span>Belum ada pesanan.</span>';
        return;
      }

      list.innerHTML = orders.map(order => `
        <div class="order-item">
          <strong>${order.productName}</strong> - ${new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(order.price)}
          <br><small>${new Date(order.date).toLocaleDateString()} ‚Ä¢ ${order.status}</small>
        </div>
      `).join('');
    }

    function changePassword() {
      const old = document.getElementById('oldPass').value;
      const newPass = document.getElementById('newPass').value;
      const confirm = document.getElementById('confirmPass').value;

      if (!old || !newPass || !confirm) {
        showNotification('Semua field wajib diisi!');
        return;
      }

      if (newPass !== confirm) {
        showNotification('Password baru tidak cocok!');
        return;
      }

      const users = JSON.parse(localStorage.getItem('users')) || [];
      const user = JSON.parse(localStorage.getItem('loggedUser'));

      if (user.password !== old) {
        showNotification('Password lama salah!');
        return;
      }

      // Update di users
      const idx = users.findIndex(u => u.email === user.email);
      users[idx].password = newPass;
      localStorage.setItem('users', JSON.stringify(users));

      // Update loggedUser
      user.password = newPass;
      localStorage.setItem('loggedUser', JSON.stringify(user));

      showNotification('Password berhasil diubah!');
      document.getElementById('oldPass').value = '';
      document.getElementById('newPass').value = '';
      document.getElementById('confirmPass').value = '';
    }

    function updateProfile() {
      const username = document.getElementById('editUsername').value.trim();
      const phone = document.getElementById('editPhone').value.trim();

      if (!username || !phone) {
        showNotification('Username dan telepon wajib diisi!');
        return;
      }

      const users = JSON.parse(localStorage.getItem('users')) || [];
      const user = JSON.parse(localStorage.getItem('loggedUser'));

      const idx = users.findIndex(u => u.email === user.email);
      users[idx].username = username;
      users[idx].phone = phone;
      localStorage.setItem('users', JSON.stringify(users));

      user.username = username;
      user.phone = phone;
      localStorage.setItem('loggedUser', JSON.stringify(user));

      showNotification('Profil berhasil diperbarui!');
      loadProfile();
    }

    loadProfile();
    loadOrders();
  </script>
</body>
</html>
